<div class="container">
  <div class="message" [ngClass]="{'direct-message': (chatMessage.isDirect || chatMessage.isSecret), 'system-message':chatMessage.isSystem, 'dicebot-message': chatMessage.isDicebot}"
    [@flyInOut]="animeState">
    <ng-container *ngIf="!useLilyMessageColor">
      <div class="image">
        <img *ngIf="0 < imageFile?.url?.length" [src]="imageFile?.url | safe: 'resourceUrl'" />
      </div>
      <div class="body">
        <div class="title">
          <span class="msg-name" [style.color]="usePlayerColor && isMyMessage  ? playerColor : ''">{{chatMessage.name}}</span>
          <span class='tip msg-from'>{{chatMessage.from}}</span>
          <span class='tip msg-timestamp'>{{chatMessage.timestamp | date:'y/M/d H:mm'}}</span>
        </div>
        <div class="text msg-text">
          <ng-container *ngIf="!chatMessage.isSecret || chatMessage.isSendFromSelf; then visible; else secret"></ng-container>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="useLilyMessageColor && !chatMessage.chatSimpleDispFlag">
      <div class="image">
        <img *ngIf="0 < imageFile?.url?.length" [src]="imageFile?.url | safe: 'resourceUrl'" />
      </div>
      <div class="body" [ngStyle]="{'color': chatMessage.messColor }">
        <div class="title">
          <span class="msg-name" [style.color]="usePlayerColor && isMyMessage  ? playerColor : ''">{{chatMessage.name}}</span>
          <span class='tip msg-from'>{{chatMessage.from}}</span>
          <span class='tip msg-timestamp'>{{chatMessage.timestamp | date:'y/M/d H:mm'}}</span>
        </div>
        <div class="text msg-text">
          <ng-container *ngIf="!chatMessage.isSecret || chatMessage.isSendFromSelf; then visible; else secret"></ng-container>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="useLilyMessageColor && chatMessage.chatSimpleDispFlag">
      <div class="message-small" [ngClass]="{'direct-message': (chatMessage.isDirect || chatMessage.isSecret), 'system-message':chatMessage.isSystem, 'dicebot-message': chatMessage.isDicebot}">
        <div class="body" [ngStyle]="{'color': chatMessage.messColor }">
          <span class="title">
            <span class="msg-name">{{chatMessage.name}}</span>
            <span *ngIf="chatMessage.simpleDispFlagUserId" class='tip msg-from'>{{chatMessage.from}}</span>
            <span *ngIf="chatMessage.simpleDispFlagTime" class='tip msg-timestamp'>{{chatMessage.timestamp | date:'H:mm'}}</span>
            <span class="text msg-text">
              <ng-container *ngIf="!chatMessage.isSecret || chatMessage.isSendFromSelf; then visible; else secret">
              </ng-container>
            </span>
          </span>
        </div>
      </div>
    </ng-container>

  </div>
</div>
<ng-template #visible>
  <span>{{chatMessage.text}}</span>
  <button *ngIf="chatMessage.isSecret" (click)="discloseMessage()">結果を公開</button>
</ng-template>
<ng-template #secret>
  <span>（シークレットダイス）</span>
</ng-template>
